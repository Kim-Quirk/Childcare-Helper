{
  "version": 3,
  "sources": ["../../../src/cli/deploy.ts"],
  "sourcesContent": ["import chalk from \"chalk\";\nimport { Command, Option } from \"commander\";\nimport { getUrlAndAdminKey } from \"./lib/api\";\nimport { readProjectConfig } from \"./lib/config\";\nimport { logFinishedStep, oneoffContext, showSpinner } from \"./lib/context\";\nimport { buildEnvironment, offerToWriteToEnv } from \"./lib/envvars\";\nimport { PushOptions, runPush } from \"./lib/push\";\n\nexport const deploy = new Command(\"deploy\")\n  .description(\"Deploy to a production deployment\")\n  .option(\"-v, --verbose\", \"Show full listing of changes\")\n  .option(\n    \"--dry-run\",\n    \"Print out the generated configuration without deploying to your production deployment\"\n  )\n  .addOption(\n    new Option(\n      \"--typecheck <mode>\",\n      `Whether to check TypeScript files with \\`tsc --noEmit\\` before deploying.`\n    )\n      .choices([\"enable\", \"try\", \"disable\"])\n      .default(\"try\")\n  )\n  .addOption(\n    new Option(\n      \"--codegen <mode>\",\n      \"Whether to regenerate code in `convex/_generated/` before pushing.\"\n    )\n      .choices([\"enable\", \"disable\"])\n      .default(\"enable\")\n  )\n  .option(\n    \"--save-url\",\n    \"Save the production deployment URL to .env or .env.production.\"\n  )\n  .option(\n    \"--no-save-url\",\n    \"Do not save production deployment URL to a .env file. (default)\"\n  )\n\n  .addOption(new Option(\"--debug-bundle-path <path>\").hideHelp())\n  .addOption(new Option(\"--debug\").hideHelp())\n  // harmless deprecated option\n  .addOption(new Option(\"-y, --yes\").hideHelp())\n  // Hidden options to pass in admin key and url for tests and local development\n  .addOption(new Option(\"--admin-key <adminKey>\").hideHelp())\n  .addOption(new Option(\"--url <url>\").hideHelp())\n  .showHelpAfterError()\n  .action(async cmdOptions => {\n    const ctx = oneoffContext;\n    const saveUrl = cmdOptions.saveUrl ? \"yes\" : \"no\";\n    const projectConfig = (await readProjectConfig(ctx)).projectConfig;\n    let adminKey = cmdOptions.adminKey;\n    const url = cmdOptions.url ?? projectConfig.prodUrl;\n\n    if (process.env.CONVEX_DEPLOY_KEY) {\n      adminKey = process.env.CONVEX_DEPLOY_KEY;\n    }\n\n    const buildEnvironmentExpectsConvexDeployKey = buildEnvironment();\n\n    if (!adminKey) {\n      if (buildEnvironmentExpectsConvexDeployKey) {\n        console.error(\n          chalk.yellow(\n            `${buildEnvironmentExpectsConvexDeployKey} build environment detected but CONVEX_DEPLOY_KEY is not set. Set this environment variable to deploy from this environment.`\n          )\n        );\n        await ctx.crash(1);\n      }\n      adminKey = (\n        await getUrlAndAdminKey(\n          ctx,\n          projectConfig.project,\n          projectConfig.team,\n          \"prod\"\n        )\n      ).adminKey;\n    }\n\n    await offerToWriteToEnv(ctx, \"prod\", url, saveUrl);\n\n    const options: PushOptions = {\n      adminKey,\n      verbose: !!cmdOptions.verbose,\n      dryRun: !!cmdOptions.dryRun,\n      typecheck: cmdOptions.typecheck,\n      debug: !!cmdOptions.debug,\n      debugBundlePath: cmdOptions.debugBundlePath,\n      codegen: cmdOptions.codegen === \"enable\",\n      url,\n    };\n    showSpinner(\n      ctx,\n      `Deploying to ${url}...${options.dryRun ? \" [dry run]\" : \"\"}`\n    );\n    await runPush(oneoffContext, options);\n    logFinishedStep(\n      ctx,\n      `${\n        options.dryRun ? \"Would have deployed\" : \"Deployed\"\n      } Convex functions to ${url}`\n    );\n  });\n"],
  "mappings": ";AAAA,OAAO,WAAW;AAClB,SAAS,SAAS,cAAc;AAChC,SAAS,yBAAyB;AAClC,SAAS,yBAAyB;AAClC,SAAS,iBAAiB,eAAe,mBAAmB;AAC5D,SAAS,kBAAkB,yBAAyB;AACpD,SAAsB,eAAe;AAE9B,aAAM,SAAS,IAAI,QAAQ,QAAQ,EACvC,YAAY,mCAAmC,EAC/C,OAAO,iBAAiB,8BAA8B,EACtD;AAAA,EACC;AAAA,EACA;AACF,EACC;AAAA,EACC,IAAI;AAAA,IACF;AAAA,IACA;AAAA,EACF,EACG,QAAQ,CAAC,UAAU,OAAO,SAAS,CAAC,EACpC,QAAQ,KAAK;AAClB,EACC;AAAA,EACC,IAAI;AAAA,IACF;AAAA,IACA;AAAA,EACF,EACG,QAAQ,CAAC,UAAU,SAAS,CAAC,EAC7B,QAAQ,QAAQ;AACrB,EACC;AAAA,EACC;AAAA,EACA;AACF,EACC;AAAA,EACC;AAAA,EACA;AACF,EAEC,UAAU,IAAI,OAAO,4BAA4B,EAAE,SAAS,CAAC,EAC7D,UAAU,IAAI,OAAO,SAAS,EAAE,SAAS,CAAC,EAE1C,UAAU,IAAI,OAAO,WAAW,EAAE,SAAS,CAAC,EAE5C,UAAU,IAAI,OAAO,wBAAwB,EAAE,SAAS,CAAC,EACzD,UAAU,IAAI,OAAO,aAAa,EAAE,SAAS,CAAC,EAC9C,mBAAmB,EACnB,OAAO,OAAM,eAAc;AAC1B,QAAM,MAAM;AACZ,QAAM,UAAU,WAAW,UAAU,QAAQ;AAC7C,QAAM,iBAAiB,MAAM,kBAAkB,GAAG,GAAG;AACrD,MAAI,WAAW,WAAW;AAC1B,QAAM,MAAM,WAAW,OAAO,cAAc;AAE5C,MAAI,QAAQ,IAAI,mBAAmB;AACjC,eAAW,QAAQ,IAAI;AAAA,EACzB;AAEA,QAAM,yCAAyC,iBAAiB;AAEhE,MAAI,CAAC,UAAU;AACb,QAAI,wCAAwC;AAC1C,cAAQ;AAAA,QACN,MAAM;AAAA,UACJ,GAAG;AAAA,QACL;AAAA,MACF;AACA,YAAM,IAAI,MAAM,CAAC;AAAA,IACnB;AACA,gBACE,MAAM;AAAA,MACJ;AAAA,MACA,cAAc;AAAA,MACd,cAAc;AAAA,MACd;AAAA,IACF,GACA;AAAA,EACJ;AAEA,QAAM,kBAAkB,KAAK,QAAQ,KAAK,OAAO;AAEjD,QAAM,UAAuB;AAAA,IAC3B;AAAA,IACA,SAAS,CAAC,CAAC,WAAW;AAAA,IACtB,QAAQ,CAAC,CAAC,WAAW;AAAA,IACrB,WAAW,WAAW;AAAA,IACtB,OAAO,CAAC,CAAC,WAAW;AAAA,IACpB,iBAAiB,WAAW;AAAA,IAC5B,SAAS,WAAW,YAAY;AAAA,IAChC;AAAA,EACF;AACA;AAAA,IACE;AAAA,IACA,gBAAgB,SAAS,QAAQ,SAAS,eAAe;AAAA,EAC3D;AACA,QAAM,QAAQ,eAAe,OAAO;AACpC;AAAA,IACE;AAAA,IACA,GACE,QAAQ,SAAS,wBAAwB,kCACnB;AAAA,EAC1B;AACF,CAAC;",
  "names": []
}
