{
  "version": 3,
  "sources": ["../../../src/react-clerk/ConvexProviderWithClerk.tsx"],
  "sourcesContent": ["import { useAuth } from \"@clerk/clerk-react\";\nimport React from \"react\";\n\nimport { ReactNode, useCallback, useMemo } from \"react\";\nimport { AuthTokenFetcher } from \"../browser/sync/client.js\";\nimport { ConvexProviderWithAuth } from \"../react/ConvexAuthState.js\";\n\n// Until we can import from our own entry points (requires TypeScript 4.7),\n// just describe the interface enough to help users pass the right type.\ntype IConvexReactClient = {\n  setAuth(fetchToken: AuthTokenFetcher): void;\n  clearAuth(): void;\n};\n\n/**\n * A wrapper React component which provides a {@link react.ConvexReactClient}\n * authenticated with Clerk.\n *\n * It must be wrapped by a configured `ClerkProvider`, from\n * `@clerk/clerk-react`, `@clerk/clerk-expo`, `@clerk/clerk-next` or\n * another React-based Clerk client library.\n *\n * See [Convex Clerk](https://docs.convex.dev/auth/clerk) on how to set up\n * Convex with Clerk.\n *\n * @public\n */\nexport function ConvexProviderWithClerk({\n  children,\n  client,\n}: {\n  children: ReactNode;\n  client: IConvexReactClient;\n}) {\n  return (\n    <ConvexProviderWithAuth client={client} useAuth={useAuthFromClerk}>\n      {children}\n    </ConvexProviderWithAuth>\n  );\n}\n\nfunction useAuthFromClerk() {\n  const { isLoaded, isSignedIn, getToken } = useAuth();\n  const fetchAccessToken = useCallback(\n    async ({ forceRefreshToken }: { forceRefreshToken: boolean }) => {\n      try {\n        return getToken({ template: \"convex\", skipCache: forceRefreshToken });\n      } catch (error) {\n        return null;\n      }\n    },\n    // Clerk is not memoizing its getToken function at all\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n  return useMemo(\n    () => ({\n      isLoading: !isLoaded,\n      isAuthenticated: isSignedIn ?? false,\n      fetchAccessToken,\n    }),\n    [isLoaded, isSignedIn, fetchAccessToken]\n  );\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAwB;AACxB,mBAAkB;AAElB,IAAAA,gBAAgD;AAEhD,6BAAuC;AAsBhC,SAAS,wBAAwB;AAAA,EACtC;AAAA,EACA;AACF,GAGG;AACD,SACE,6BAAAC,QAAA,cAAC,iDAAuB,QAAgB,SAAS,oBAC9C,QACH;AAEJ;AAEA,SAAS,mBAAmB;AAC1B,QAAM,EAAE,UAAU,YAAY,SAAS,QAAI,4BAAQ;AACnD,QAAM,uBAAmB;AAAA,IACvB,OAAO,EAAE,kBAAkB,MAAsC;AAC/D,UAAI;AACF,eAAO,SAAS,EAAE,UAAU,UAAU,WAAW,kBAAkB,CAAC;AAAA,MACtE,SAAS,OAAP;AACA,eAAO;AAAA,MACT;AAAA,IACF;AAAA,IAGA,CAAC;AAAA,EACH;AACA,aAAO;AAAA,IACL,OAAO;AAAA,MACL,WAAW,CAAC;AAAA,MACZ,iBAAiB,cAAc;AAAA,MAC/B;AAAA,IACF;AAAA,IACA,CAAC,UAAU,YAAY,gBAAgB;AAAA,EACzC;AACF;",
  "names": ["import_react", "React"]
}
