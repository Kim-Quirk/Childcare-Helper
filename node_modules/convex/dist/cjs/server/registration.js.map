{
  "version": 3,
  "sources": ["../../../src/server/registration.ts"],
  "sourcesContent": ["import {\n  Auth,\n  DatabaseReader,\n  DatabaseWriter,\n  StorageActionWriter,\n  StorageReader,\n  StorageWriter,\n} from \".\";\nimport {\n  ActionNames,\n  GenericAPI,\n  MutationNames,\n  NamedAction,\n  NamedMutation,\n  NamedQuery,\n  OptionalRestArgs,\n  QueryNames,\n} from \"../browser\";\nimport { ObjectType, PropertyValidators } from \"../values/validator\";\nimport { GenericDataModel } from \"./data_model.js\";\nimport { Scheduler } from \"./scheduler\";\n/**\n * A set of services for use within Convex mutation functions.\n *\n * The mutation context is passed as the first argument to any Convex mutation\n * function run on the server.\n *\n * If you're using code generation, use the `MutationCtx` type in\n * `convex/_generated/server.d.ts` which is typed for your data model.\n *\n * @public\n */\nexport interface MutationCtx<\n  DataModel extends GenericDataModel,\n  API extends GenericAPI\n> {\n  /**\n   * A utility for reading and writing data in the database.\n   */\n  db: DatabaseWriter<DataModel>;\n\n  /**\n   * Information about the currently authenticated user.\n   */\n  auth: Auth;\n\n  /**\n   * A utility for reading and writing files in storage.\n   */\n  storage: StorageWriter;\n\n  /**\n   * A utility for scheduling Convex functions to run in the future.\n   */\n  scheduler: Scheduler<API>;\n}\n\n/**\n * A set of services for use within Convex query functions.\n *\n * The query context is passed as the first argument to any Convex query\n * function run on the server.\n *\n * This differs from the {@link MutationCtx} because all of the services are\n * read-only.\n *\n * If you're using code generation, use the `QueryCtx` type in\n * `convex/_generated/server.d.ts` which is typed for your data model.\n *\n * @public\n */\nexport interface QueryCtx<DataModel extends GenericDataModel> {\n  /**\n   * A utility for reading data in the database.\n   */\n  db: DatabaseReader<DataModel>;\n\n  /**\n   * Information about the currently authenticated user.\n   */\n  auth: Auth;\n\n  /**\n   * A utility for reading files in storage.\n   */\n  storage: StorageReader;\n}\n\n/**\n * A set of services for use within Convex action functions.\n *\n * The context is passed as the first argument to any Convex action\n * run on the server.\n *\n * If you're using code generation, use the `ActionCtx` type in\n * `convex/_generated/server.d.ts` which is typed for your data model.\n *\n * @public\n */\nexport interface ActionCtx<API extends GenericAPI> {\n  /**\n   * Runs the Convex query with the given name and arguments.\n   *\n   * Consider using an {@link internalQuery} to prevent users from calling the\n   * query directly.\n   */\n  runQuery<Name extends QueryNames<API>>(\n    name: Name,\n    ...args: OptionalRestArgs<NamedQuery<API, Name>>\n  ): Promise<ReturnType<NamedQuery<API, Name>>>;\n\n  /**\n   * Runs the Convex mutation with the given name and arguments.\n   *\n   * Consider using an {@link internalMutation} to prevent users from calling\n   * the mutation directly.\n   */\n  runMutation<Name extends MutationNames<API>>(\n    name: Name,\n    ...args: OptionalRestArgs<NamedMutation<API, Name>>\n  ): Promise<ReturnType<NamedMutation<API, Name>>>;\n\n  /**\n   * Runs the Convex action with the given name and arguments.\n   *\n   * Consider using an {@link internalAction} to prevent users from calling the\n   * action directly.\n   */\n  runAction<Name extends ActionNames<API>>(\n    name: Name,\n    ...args: OptionalRestArgs<NamedAction<API, Name>>\n  ): Promise<ReturnType<NamedAction<API, Name>>>;\n\n  /**\n   * A utility for scheduling Convex functions to run in the future.\n   */\n  scheduler: Scheduler<API>;\n\n  /**\n   * Information about the currently authenticated user.\n   */\n  auth: Auth;\n\n  /**\n   * A utility for reading and writing files in storage.\n   */\n  storage: StorageActionWriter;\n}\n\n/**\n * The arguments to a Convex query, mutation, or action function.\n *\n * Convex functions always take an arguments object that maps the argument\n * names to their values.\n *\n * @public\n */\nexport type FunctionArgs = Record<string, unknown>;\n\n/**\n * The arguments array for a function that takes arguments.\n *\n * This is an array of a single {@link FunctionArgs} element.\n */\ntype OneArgArray = [FunctionArgs];\n\n/**\n * The arguments to a function that takes no arguments (just an empty array).\n */\ntype NoArgsArray = [];\n\n/**\n * An array of arguments to a Convex function.\n *\n * Convex functions can take either a single {@link FunctionArgs} object or no\n * args at all.\n */\nexport type ArgsArray = OneArgArray | NoArgsArray;\n\n/**\n * A type representing the visibility of a Convex function.\n */\ntype FunctionVisibility = \"public\" | \"internal\";\n\n/**\n * Given a {@link FunctionVisibility}, should this function have `isPublic: true`\n * or `isInternal: true`?\n */\ntype VisibilityProperties<Visiblity extends FunctionVisibility> =\n  Visiblity extends \"public\"\n    ? {\n        isPublic: true;\n      }\n    : {\n        isInternal: true;\n      };\n\n/**\n * A mutation function that is part of this app.\n *\n * You can create a mutation by wrapping your function in\n * {@link mutationGeneric} or {@link internalMutationGeneric} and exporting it.\n *\n * @public\n */\nexport type RegisteredMutation<\n  Visibility extends FunctionVisibility,\n  Args extends ArgsArray,\n  Output\n> = {\n  (ctx: MutationCtx<any, any>, ...args: Args): Output;\n\n  args: Args;\n  output: Output;\n\n  isMutation: true;\n  isRegistered?: true;\n\n  /** @internal */\n  invokeMutation(argsStr: string): Promise<string>;\n\n  /** @internal */\n  exportArgs(): string;\n} & VisibilityProperties<Visibility>;\n\n/**\n * A query function that is part of this app.\n *\n * You can create a query by wrapping your function in\n * {@link queryGeneric} or {@link internalQueryGeneric} and exporting it.\n *\n * @public\n */\nexport type RegisteredQuery<\n  Visibility extends FunctionVisibility,\n  Args extends ArgsArray,\n  Output\n> = {\n  (ctx: QueryCtx<any>, ...args: Args): Output;\n\n  args: Args;\n  output: Output;\n\n  isQuery: true;\n  isRegistered?: true;\n\n  /** @internal */\n  invokeQuery(argsStr: string): Promise<string>;\n\n  /** @internal */\n  exportArgs(): string;\n} & VisibilityProperties<Visibility>;\n\n/**\n * An action that is part of this app.\n *\n * You can create an action by wrapping your function in\n * {@link actionGeneric} or {@link internalActionGeneric} and exporting it.\n *\n * @public\n */\nexport type RegisteredAction<\n  Visibility extends FunctionVisibility,\n  Args extends ArgsArray,\n  Output\n> = {\n  (ctx: ActionCtx<any>, ...args: Args): Output;\n\n  args: Args;\n  output: Output;\n\n  isAction: true;\n  isRegistered?: true;\n\n  /** @internal */\n  invokeAction(requestId: string, argsStr: string): Promise<string>;\n\n  /** @internal */\n  exportArgs(): string;\n} & VisibilityProperties<Visibility>;\n\n/**\n * An HTTP action that is part of this app's public API.\n *\n * You can create public HTTP actions by wrapping your function in\n * {@link httpActionGeneric} and exporting it.\n *\n * @public\n */\nexport type PublicHttpAction = {\n  (ctx: ActionCtx<any>, request: Request): Response;\n  isHttp: true;\n  isRegistered?: true;\n\n  /** @internal */\n  invokeHttpAction(request: Request): Promise<Response>;\n};\n\n/**\n * The definition of a Convex query, mutation, or action function without\n * argument validation.\n *\n * Convex functions always take a context object as their first argument\n * and an (optional) args object as their second argument.\n *\n * This can be written as a function like:\n * ```js\n * import { query } from \"./_generated/server\";\n *\n * export const func = query(({ db }, { arg }) => {...});\n * ```\n * or as an object like:\n *\n * ```js\n * import { query } from \"./_generated/server\";\n *\n * export const func = query({\n *   handler: ({ db }, { arg }) => {...},\n * });\n * ```\n * See {@link ValidatedFunction} to add argument validation.\n *\n * @public\n */\nexport type UnvalidatedFunction<Ctx, Args extends ArgsArray, Output> =\n  | ((ctx: Ctx, ...args: Args) => Output)\n  | {\n      handler: (ctx: Ctx, ...args: Args) => Output;\n    };\n\n/**\n * The definition of a Convex query, mutation, or action function with argument\n * validation.\n *\n * Argument validation allows you to assert that the arguments to this function\n * are the expected type.\n *\n * Example:\n *\n * ```js\n * import { query } from \"./_generated/server\";\n * import { v } from \"convex/values\";\n *\n * export const func = query({\n *   args: {\n *     arg: v.string()\n *   },\n *   handler: ({ db }, { arg }) => {...},\n * });\n * ```\n *\n * **For security, argument validation should be added to all public functions in\n * production apps.**\n *\n * See {@link UnvalidatedFunction} for functions without argument validation.\n * @public\n */\nexport interface ValidatedFunction<\n  Ctx,\n  ArgsValidator extends PropertyValidators,\n  Output\n> {\n  /**\n   * A validator for the arguments of this function.\n   *\n   * This is an object mapping argument names to validators constructed with\n   * {@link values.v}.\n   *\n   * ```js\n   * import { v } from \"convex/values\";\n   *\n   * const args = {\n   *   stringArg: v.string(),\n   *   optionalNumberArg: v.optional(v.number()),\n   * }\n   * ```\n   */\n  args: ArgsValidator;\n\n  /**\n   * The implementation of this function.\n   *\n   * This is a function that takes in the appropriate context and arguments\n   * and produces some result.\n   *\n   * @param ctx - The context object. This is one of {@link QueryCtx},\n   * {@link MutationCtx}, or {@link ActionCtx} depending on the function type.\n   * @param args - The arguments object for this function. This will match\n   * the type defined by the argument validator.\n   * @returns\n   */\n  handler: (ctx: Ctx, args: ObjectType<ArgsValidator>) => Output;\n}\n\n/**\n * Internal type helper used by Convex code generation.\n *\n * Used to give {@link mutationGeneric} a type specific to your data model.\n * @public\n */\nexport type MutationBuilder<\n  DataModel extends GenericDataModel,\n  API extends GenericAPI,\n  Visibility extends FunctionVisibility\n> = {\n  <Output, ArgsValidator extends PropertyValidators>(\n    func: ValidatedFunction<MutationCtx<DataModel, API>, ArgsValidator, Output>\n  ): RegisteredMutation<Visibility, [ObjectType<ArgsValidator>], Output>;\n\n  <Output, Args extends ArgsArray = OneArgArray>(\n    func: UnvalidatedFunction<MutationCtx<DataModel, API>, Args, Output>\n  ): RegisteredMutation<Visibility, Args, Output>;\n};\n\n/**\n * Internal type helper used by Convex code generation.\n *\n * Used to give {@link queryGeneric} a type specific to your data model.\n * @public\n */\nexport type QueryBuilder<\n  DataModel extends GenericDataModel,\n  Visibility extends FunctionVisibility\n> = {\n  <Output, ArgsValidator extends PropertyValidators>(\n    func: ValidatedFunction<QueryCtx<DataModel>, ArgsValidator, Output>\n  ): RegisteredQuery<Visibility, [ObjectType<ArgsValidator>], Output>;\n\n  <Output, Args extends ArgsArray = OneArgArray>(\n    func: UnvalidatedFunction<QueryCtx<DataModel>, Args, Output>\n  ): RegisteredQuery<Visibility, Args, Output>;\n};\n\n/**\n * Internal type helper used by Convex code generation.\n *\n * Used to give {@link actionGeneric} a type specific to your data model.\n * @public\n */\nexport type ActionBuilder<\n  API extends GenericAPI,\n  Visibility extends FunctionVisibility\n> = {\n  <Output, ArgsValidator extends PropertyValidators>(\n    func: ValidatedFunction<ActionCtx<API>, ArgsValidator, Output>\n  ): RegisteredAction<Visibility, [ObjectType<ArgsValidator>], Output>;\n\n  <Output, Args extends ArgsArray = OneArgArray>(\n    func: UnvalidatedFunction<ActionCtx<API>, Args, Output>\n  ): RegisteredAction<Visibility, Args, Output>;\n};\n\n/**\n * Internal type helper used by Convex code generation.\n *\n * Used to give {@link httpActionGeneric} a type specific to your data model\n * and functions.\n * @public\n */\nexport type HttpActionBuilderForAPI<API extends GenericAPI> = (\n  func: (ctx: ActionCtx<API>, request: Request) => Promise<Response>\n) => PublicHttpAction;\n"],
  "mappings": ";;;;;;;;;;;;;;AAAA;AAAA;",
  "names": []
}
